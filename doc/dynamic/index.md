# 伪动态路线规划

一般来说，Mud的路线规划包括静态规划和动态规划。

这里的静态规划和动态规划的定义为

* 静态规划：在地图上进行规划时，各个路径的移动互相独立，不会相互干扰。一般的路线规划都是这种。
* 动态规划：在规划时，一个行动可能会影响到其他行动。比如你进入A出口，可能会关闭b和c出口。这种一般是动态迷宫的解法。

HellMapManager(HMM)是用于静态路线规划的工具。为了解决实际上地图的动态化的需求，引入了上下文(Context)的概念，通过 **动态**的生成 **静态地图** 的方法,来完成实际需求。

具体来说，把地图分为固定和动态的两个部分。

固定的部分，以静态文件的形式，作为代码的一部分，既代码的固有数据。

动态的部分，由代码在运行时，根据实际的ID和服务器状态进行实时生成。

在每次路线规划时，同时使用固定部分和动态部分生成当前的静态地区信息。

在这里，HMM将固定部分成为地图信息，而动态部分，称为上下文。

## 上下文与环境信息

这两者在HMM其实是统一个东西，只是数据结构略有不同，更适合直接调用/序列化接口调用

上下文包含的内容包含

* Tags 标签，字符串>数字对，匹配 出口中的出口条件，动态的开关出口。
* RoomConditions 房间条件，与Tags想法，匹配房间的标签，动态的开关房间。
* Rooms 房间列表，额外的临时房间，可以存放个人房屋/迷宫等非通用的房间。
* Whitelist 白名单，限制只在指定的房间中规划，较少使用，一般可以使用房间条件进行限制。
* Blacklist 黑名单，临时拉黑某些房间，可以应对临时变危险的房间。
* Shortcuts 捷径，一般是个人专属的可以飞行到某些地点的指令。
* Paths 临时路径，一般用来将临时房间与固定房间相连，也可以在特殊的情况下使用。
* BlockedLinks 禁用路径，一般用于被npc拦路或者临时关闭的情况下，临时禁止某两个房间的之间的路径参与规划。
* CommandCosts 临时指令消耗，临时调整某些指令的消耗，变相实现路径消耗的动态化。理论上解决实现特殊门派的特殊指令和其他门派的消耗不同的情况。

本质上，上下包含的内容，就是临时加入/开关/修改固定地图中现有的信息，对固定地图进行微调。