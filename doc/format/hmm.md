# HMM格式

HellMapManager(HMM)一共使用3种格式的数据文件

* .hmm 文本格式的地图信息
* .hmz 2进制(zip压缩)格式的地图信息
* .hmp 2进制(zip压缩)格式的补丁信息

除了是否通过zip压缩以外，这3种格式都是以行为单位，第一行为文件格式头，之后每行是特殊多层带分隔符的字符串数组。

编码与解码方式是一致的

## 转义

HMM格式中使用了多个保留字符作为控制符。包括：
* 换行 转义为 \\n
* \\ 转义为 \\\\
* \> 转义为 \\>
* | 转义为 \\|
* : 转义为\\:
* ; 转义为 \\;
* = 转义为 \\=
* , 转义为 \\,
* @ 转义为 \\@
* & 转义为 \\&
* ^ 转义为 \\^
* \` 转义为 \\\`
* ! 转义为 \\!

## 控制符

控制符分为 键值控制符和列表控制符。为了在脚本里能方便的解码和编码，HMM预设了最大5层控制符，每一层有一个建值控制符和列表控制符

* 第1层: 键值控制符\> 列表控制符 |
* 第2层: 键值控制符: 列表控制符 ;
* 第3层: 键值控制符= 列表控制符 ,
* 第4层: 键值控制符@ 列表控制符 &
* 第5层: 键值控制符^ 列表控制符 `

此外，还有统一的取否控制符 !

### 数据结构

HMM格式中的数据结构有5种

**列表**

字符串数组，所有的值由对应层的列表控制符控制。

例

```
a|b|c|d
```

**键值对(KeyValue)**

由一个字符串Key和一个字符串Value组成，由对应层的键值控制符分割。

例
```
KeyA>ValueA
```


**开关值**

由一个bool值和一个字符串值组成

bool值为true,就是字符串值本身。bool值为false,就是取否控制符拼接字符串

例
```
ValueTrue
!ValueNot
```

**开关键值对**

由一个bool值，一个字符串键，一个字符串值组成

先将键值拼接为键值对，再和bool值一起拼接为开关值

例
```
KeyTrue>ValueTrue
!KeyFalse>ValueFalse
```

## 顶级主键

HMM格式的数据每条记录都是一个键值对，顶级的主键在解析的时候决定了这是一条什么记录

顶级主键包括
* Info 信息数据
* Room 房间数据
* Marker 标记数据
* Route 路线数据
* Trace 足迹数据
* Region 地区数据
* Landmark 定位数据
* Shortcut 捷径数据
* Variable 变量数据
* Snapshot 快照数据
* RemoveRoom 移除房间,补丁格式中使用
* RemoveMarker 移除标记,补丁格式中使用
* RemoveRoute 移除路线,补丁格式中使用
* RemoveTrace 移除足迹,补丁格式中使用
* RemoveRegion 移除地区,补丁格式中使用
* RemoveLandmark 移除定位,补丁格式中使用
* RemoveShortcut 移除捷径,补丁格式中使用
* RemoveVariable 移除变量,补丁格式中使用
* RemoveSnapshot 移除快照,补丁格式中使用